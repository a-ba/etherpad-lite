# configure a container named etherpad that:
# - stores its dirty.db into the var/ subdirectory
etherpad:

    # build its image from the current directory
    build:  .

    # we override the etherpad user inside the container so that the app is run
    # under the same uid as the developer on the host machine
    # (note: the environment variable $DOCKER_USER is set in .env which is
    # generated by the ./bootstrap script)
    user:   "$DOCKERUSER"

    # TCP redirection: redirect port 9001 of the local host to the 9001 port of
    # the container
    ports:
        - "9001:9001"

    volumes:
        # mount /opt/etherpad from the current source dir
        # (so that we do not need to rebuild the image each time we modify the
        #  sources)
        - .:/opt/etherpad

        # mount var/ from an external volume to store persistent data
        # (this is needed here because of the VOLUME instruction in the
        #  Dockerfile: an anonymous volume would be mounted as
        #  /opt/etherpad/var otherwise)
        - ./var:/opt/etherpad/var

    environment:
        # set the HOME dir to a location in our external volume, so as to
        # - cache the npm packages (~/.npm)
        # - keep the bash history (and other state files useful for the
        #   developer)
        HOME: "/opt/etherpad/var/home"


# vim:sts=4:sw=4:
